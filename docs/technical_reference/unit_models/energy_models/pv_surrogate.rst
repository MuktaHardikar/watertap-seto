Photovoltaic (PV) Surrogate Model
====================================================

This Photovoltaic (PV) unit model is a surrogate model that inherits its base model structure from the `Solar Energy Base Model <https://watertap.readthedocs.io/en/latest/technical_reference/unit_models/energy_models/solar_energy_base.html>`_.
The model is trained using the data generated by the PV Model from `PySAM <https://nrel-pysam.readthedocs.io/en/main/>`_ which is is a Python package for the National Renewable Energy Laboratory's `System Advisor Model (SAM) <https://sam.nrel.gov>`_.
The unit model supports steady state only.

Degrees of Freedom
------------------

The PV surrogate model has only 1 degree of freedom for the system capacity.

.. csv-table::
   :header: "Variable", "Variable Name","Symbol", "Units", "Description"

   "System Capacity", "`system_capacity`", ":math:`Capacity_{system}`", ":math:`\text{kW}`", "Thermal power output of the system"


Generating Data
---------------

The data for the surrogate model can be generated using the `generate_pv_data` function in `run_pysam_pv.py` in the REFLO package.
The default weather file and the config files are included in the REFLO package.
Weather specific to the user's location can be downloaded from the `National Solar Radiation Database <https://nsrdb.nrel.gov/data-viewer>`_ and configuration ``.json`` files can be created using SAM.

The `generate_pv_data` function takes the following arguments:

.. csv-table::
   :header: "Variable", "Variable Name", "Units", "Description"

   "Design Size", "``design_sizes``", ":math:`\text{kW}`", "List of range of values of interest for the PV system capacity"
   "Dataset file name", "``dataset_filename``", "", "Name of the output dataset file"


Users can update the weather file for their specific location of interest by updating the file to variable ``weather_file``.
The PV default parameters can be adjusted in the ``config_file_default`` as needed.
The `generate_pv_data` function will generate the necessary data files (.pkl or .csv) for the surrogate model.

Variables
---------

The default outputs labels for the data generated using PySAM and the PV surrogate model are:

.. csv-table::
   :header:  "Variable", "Variable Name", "Symbol", "Unit", "Description"

   "Electricity Annual", "``electricity_annual``", ":math:`E_{annual}`", ":math:`\text{kWh}`", "Annual electricity demand of the system"
   "AC Capacity Factor", "``ac_capacity_factor``", ":math:`CF_{ac}`", "", "Ratio of the system's annual AC output to the AC output if it operated at system capacity over the year"
   "DC Capacity Factor", "``dc_capacity_factor``", ":math:`CF_{dc}`", "", "Ratio of the system's annual DC output to the DC output if it operated at system capacity over the year"
   "Land Required", "``land_req``", ":math:`A_{land}`", ":math:`\text{acre}`", "Ratio of the system's annual DC output to the DC output if it operated at system capacity over the year"   
   "Real LCOE", "``lcoe_real``", ":math:`LCOE_{real}`", ":math:`\text{\$/kWh}`", "The levelized cost of energy (LCOE)"

Relevant output labels are used to cost the PV system.


Model Structure
---------------

Additional parameters included in the PV surrogate model are defined as follows:

.. csv-table::
   :header: "Parameter", "Parameter Name", "Symbol", "Valid Range", "Units"

   "Single Inverter Capacity", "``single_inverter_capacity``", ":math:`Capacity_{single-inverter}`", "2507.2", ":math:`\text{kW}`"
   "DC to AC ratio", "``DC_to_AC_ratio``", ":math:`DC/AC Ratio`", "1.2", ""


The parameters are used to calculate the land area required for the PV system.

.. math::

   \text{Inverter Capacity} = \frac{\text{System Capacity}}{\text{DC/AC Ratio}}

Costing
--------

The PV surrogate model costing is implemented through the Energy Costing Package and calculates both capital and operating costs for the PV system.
The PV surrogate unit model can be costed using either the ``simple`` or ``detailed`` costing models.

Costing-Simple
~~~~~~~~~~~~~~

The ``simple`` costing model uses a fixed cost per kW of system capacity and the cost per area of land required.
The capital cost is calculated using direct and indirect cost factors:

.. math::

   C_{simple,capital} = C_{simple,direct} + C_{simple,land}

.. math::

   C_{simple,direct} = CF_{simple, watt} \times Capacity_{system}

.. math::
   C_{simple,land} = CF_{simple, land} \times A_{land}


The fixed and variable operating costs are calculated as:

.. math::

   C_{simple,fixed-operating} = CF_{simple, fixed-operating} \times Capacity_{system}

.. math::
   C_{simple,variable-operating} = CF_{simple, variable-operating} \times E_{annual}


.. csv-table::
   :header: "Cost Component","Symbol", "Value", "Units", "Description"

   "Cost per Watt", ":math:`CF_{simple, watt}`","1.6", ":math:`\text{\$/W}`", "Cost per kW of system capacity"
   "Cost per Land Area", ":math:`CF_{simple, land}`", "0", ":math:`\text{\$/acre}`", "Cost per acre of land required in the costing package"
   "Fixed Operating Cost per Capacity", ":math:`CF_{simple, fixed-operating}`", "31", ":math:`\text{\$/kW}`", "Fixed operating cost per kW of system capacity"
   "Variable Operating Cost per Generation", ":math:`CF_{simple, variable-operating}`", "0", ":math:`\text{\$/MWh}`", "Variable operating cost per MWh of generation"


Costing-Detailed
~~~~~~~~~~~~~~

The ``detailed`` costing model uses a fixed cost per Watt of system capacity and the cost per area of land required.
The capital cost is calculated using direct and indirect cost factors:

.. math::

   C_{detailed,capital} = C_{detailed,direct} + C_{detailed,indirect} + C_{detailed,land} + C_{detailed,sales}

The direct cost and indirect costs are calculated as follows:  

.. math::

   C_{detailed,direct} = (CF_{detailed,watt} + CF_{detailed,other watt}) \times Capacity_{system} + \text{Inverter Capacity} \times CF_{detailed,inverter\_watt}

.. math::

   C_{detailed,indirect} = CF_{detailed,indirect watt} \times Capacity_{system}

The land and sales tax components are calculated as follows: 

.. math::

   C_{detailed,land} = CF_{detailed,land} \times A_{land}

.. math::

   C_{detailed,sales} = C_{detailed,direct} \times frac_{direct,CC\_sales\_tax} \times frac_{sales\_tax}


The fixed and variable operating costs are calculated as:

.. math::

   C_{detailed,fixed-operating} = CF_{detailed, fixed-operating} \times Capacity_{system}

.. math::

   C_{detailed,variable-operating} = CF_{detailed, variable-operating} \times E_{annual}

.. csv-table::
   :header: "Cost Component","Symbol", "Value", "Units", "Description"

   "Cost per Watt", ":math:`CF_{detailed, watt}`","0.34", ":math:`\text{\$/W}`", "Cost per watt for solar module"
   "Cost per Other Watt", ":math:`CF_{detailed, other\_watt}`", "0.62", ":math:`\text{\$/W}`", "Cost per watt for balance of system equipment, installation labor, and margin/overhead"
   "Cost per Inverter Watt", ":math:`CF_{detailed, inverter\_watt}`", "0.03", ":math:`\text{\$/W}`", "Cost per kW of inverter capacity"
   "Cost per Indirect Watt", ":math:`CF_{detailed, indirect\_watt}`", "0.05", ":math:`\text{\$/W}`", "Cost per watt for permitting, environmental studies, engineering, land prep, and grid interconnection"
   "Cost per Land Area", ":math:`CF_{detailed, land}`", "0", ":math:`\text{\$/acre}`", "Cost per acre of land required in the costing package"
   "Fraction of Direct Capital Cost Subject to Sales Tax", ":math:`frac_{direct,CC\_sales\_tax}`", "1", "", "Fraction of direct capital cost subject to sales tax"
   "Sales Tax", ":math:`frac_{sales\_tax}`", "", "", "Sales tax rate in the costing package"
   "Fixed Operating Cost per Capacity", ":math:`CF_{detailed, fixed-operating}`", "31", ":math:`\text{\$/kW}`", "Fixed operating cost of PV system per kW generated""
   "Variable Operating Cost per Generation", ":math:`CF_{detailed, variable-operating}`", "0", ":math:`\text{\$/MWh}`", "Annual operating cost of PV system per MWh generated"


The costing parameters can be adjusted as needed.

References
----------
* Blair, N.; Dobos, A.; Freeman, J.; Neises, T.; Wagner, M.; Ferguson, T.; Gilman, P.; Janzou, S. (2014). System Advisor Model™, SAM™ 2014.1.14: General Description. NREL/TP-6A20-61019. National Renewable Energy Laboratory. Golden, CO. Accessed May 23, 2025. www.nrel.gov/docs/fy14osti/61019.pdf . 
* System Advisor Model™ Version 2025.4.16 (SAM™ 2025.4.16). National Renewable Energy Laboratory. Golden, CO. Accessed May 23, 2025. https://https://sam.nrel.gov .