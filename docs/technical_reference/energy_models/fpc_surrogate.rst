Flat Plate Collector (Surrogate)
================================

This Flat Plate Collector (FPC) unit model is a surrogate model that inherits its base model structure from the `Solar Energy Base Model <https://watertap.readthedocs.io/en/latest/technical_reference/unit_models/energy_models/solar_energy_base.html>`_.
The unit model is trained using data generated by the Solar Water Heating model from `PySAM <https://nrel-pysam.readthedocs.io/en/main/>`_ which is is a Python package for the National Renewable Energy Laboratory's `System Advisor Model (SAM) <https://sam.nrel.gov>`_.
The unit model supports steady state only.

Degrees of Freedom
------------------

The FPC surrogate model degrees of freedom depends on the number of input labels defined by the user during data generation. The model includes at least 1 degree of freedom
for the system capacity. By default, the model includes the following input labels:

.. csv-table::
   :header: "Variable", "Variable Name", "Symbol", "Units", "Description"

   "System Capacity", "`system_capacity`", ":math:`S_{capacity}`", ":math:`\text{kW}`", "Thermal power output of the system"
   "Hours of Storage", "`hours_storage`", ":math:`h_{storage}`", ":math:`\text{h}`", "Number of hours of thermal storage"
   "Temperature Hot", "`temperature_hot`", ":math:`T_{hot}`", ":math:`\text{°C}`", "Temperature of the hot stream"

Generating Data
---------------

The data for the surrogate model can be generated using the `generate_fpc_data` function in `run_pysam_fpc.py` in the REFLO package.
The default weather file is included in the REFLO package and can be downloaded from the `National Solar Radiation Database <https://nsrdb.nrel.gov/data-viewer>`_.
Weather files specific to the user's location can be created using SAM.

The `generate_fpc_data` function takes the following arguments:

.. csv-table::
   :header: "Variable", "Variable Name", "Units", "Description"

   "System capacity", "``system_capacities``", ":math:`\text{kW}`", "List of range of values of interest for the trough system capacity"
   "Hours of storage", "``hours_storage``", ":math:`\text{h}`", "List of range of values of interest for the hours of thermal storage"
   "Temperature Hot", "``temperature_hot``", ":math:`\text{°C}`", "List of range of values of interest for the hot stream temperature"
   "Weather file", "``weather_file``", "", "Path to the weather file"
   "Dataset file name", "``dataset_filename``", "", "Name of the output dataset file"

Users can update the weather file for their specific location of interest by updating the file to variable ``weather_file_default``.
The `generate_fpc_data` function will generate the necessary data files (.pkl or .csv) for the surrogate model.

Variables
---------

The default outputs labels for the data generated using PySAM and the FPC surrogate model are:

.. csv-table::
   :header:  "Variable", "Variable Name", "Symbol", "Units", "Description"

   "Heat Annual","`heat_annual`", ":math:`H_{annual}`", ":math:`\text{kWh}`", "Annual heat production of the system"
   "Electricity Annual", "`electricity_annual`", ":math:`E_{annual}`", ":math:`\text{kWh}`", "Annual electricity demand of the system"
   "Auxilliary electric heating", "`aux_power_electric_heating`", ":math:`E_{aux}`", ":math:`\text{kWh}`", "Auxilliary electricity required by the system to main"
   "System Capacity Actual", "`system_capacity_actual`", ":math:`system_capacity`", ":math:`\text{kW}`", "System capacity recalculated after adjusting the hot water draw rate to meet desired outlet temperature"
   "Scaled Draw", "`sca`", ":math:`m_{draw}`", ":math:`\text{kWh}`", "Hot water draw rate"
   "Temperature Delivered", "`temperature_delivered`", ":math:`T_{delivered}`", ":math:`\text{°C}`", "Temperature of the fluid delivered by the solar collector"

Relevant output labels are used to cost the FPC system.

Model Structure
---------------

Additional parameters included in the CST surrogate model are defined as follows:

.. csv-table::
   :header: "Parameter", "Parameter Name", "Symbol", "Valid Range", "Units", "Description"

   "Cold Temperature", "``cold_temperature``", ":math:`T_{cold}`", "25", ":math:`\text{°C}`", "Temperature of the cold influent stream"
   "Temperature Difference Factor", "``factor_delta_T``", ":math:`\Delta T`", "", ":math:`\text{°C}`", "Temperature between the influent stream and ambient temperature"
   "Area per Collector", "``collector_area_per``", ":math:`A_{collector}`", "", ":math:`\text{m²}`", "Area of each collector"
   "FRta", "``FR_ta``", ":math:`FRta`", "", ":math:`\text{kW/m²}`", "Product of collector heat removal factor (FR), cover transmittance (t), and shortwave absorptivity of absorber (a)"
   "FRUL", "``FR_UL``", ":math:`FRUL`", "", ":math:`\text{kW/m²/K}`", "Product of collector heat removal factor (FR) and overall heat loss coeff. of collector (UL)"

The total collector area and the number of collectors is calculated as follows:

.. math::

   A_{total} = \frac{S_{capacity}}{(FRta - FRUL \times \Delta T)}

.. math::

   N_{collectors} = A_{total} / A_{collector}

The thermal storage volume is calculated as follows:

.. math::

   V_{storage} = \frac{h_{storage} \times S_{capacity}}{\rho \times c_{p} \times(T_{hot} - T_{cold})}

Costing
---------

The FPC surrogate model costing is implemented through the Energy Costing Package and calculates both capital and operating costs for the FPC system and thermal storage.

The capital cost is calculated using direct and indirect cost factors:

.. math::

    C_{capital} = C_{direct} + C_{indirect} + C_{sales\_tax}

.. math::
   C_{direct} = (C_{collector} + C_{thermal\_storage}) \times (1 + frac_{contigency})

.. math::
   C_{indirect} = C_{land} + C_{direct} \times frac_{direct}

   C_{sales\_tax} = C_{direct} \times frac_{sales\_tax}

.. csv-table::
   :header: "Cost Component","Symbol", "Equation"

   "Collector Cost", ":math:`C_{collector}`", ":math:`cost\_per\_collector \times A_{total}`"
   "Thermal Storage Cost", ":math:`C_{thermal\_storage}`", ":math:`cost\_per\_storage \times V_{storage}`"
   "Land Cost", ":math:`C_{land}`", ":math:`cost\_per\_land\_area \times A_{land}`"
 

The FPC surrogate model only has fixed operating cost is calculated as follows:

.. math::
   C_{fixed} = C_{fixed\_per\_kW} \times S_{capacity}

References
----------
* Blair, N.; Dobos, A.; Freeman, J.; Neises, T.; Wagner, M.; Ferguson, T.; Gilman, P.; Janzou, S. (2014). System Advisor Model™, SAM™ 2014.1.14: General Description. NREL/TP-6A20-61019. National Renewable Energy Laboratory. Golden, CO. Accessed May 23, 2025. www.nrel.gov/docs/fy14osti/61019.pdf . 
* System Advisor Model™ Version 2025.4.16 (SAM™ 2025.4.16). National Renewable Energy Laboratory. Golden, CO. Accessed May 23, 2025. https://https://sam.nrel.gov .